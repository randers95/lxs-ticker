<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LXS LIVE — The Liberty Exchange</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    background-color: #000;
    color: #00ff88;
    font-family: 'Courier New', monospace;
    margin: 0;
    overflow: hidden;
  }
  .overlay {
    position: absolute;
    top: 15px;
    left: 25px;
    font-size: 22px;
    color: #00ffff;
    text-shadow: 0 0 8px #00ffff;
  }
  .ticker {
    position: absolute;
    bottom: 25px;
    white-space: nowrap;
    font-size: 34px;
    color: #00ff88;
    text-shadow: 0 0 6px #00ff88;
  }
  @keyframes scroll {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }
  .scrolling {
    animation: scroll 240s linear infinite;
  }
  .symbol { margin-right: 65px; }
  .up { color: #00ff00; }
  .down { color: #ff4040; }
</style>
</head>
<body>
  <div class="overlay">LXS LIVE — The Liberty Exchange</div>
  <div class="ticker scrolling" id="ticker">
    <span>Loading ticker data...</span>
  </div>

<script>
const ticker = document.getElementById('ticker');
const FEED_URL = "https://script.google.com/macros/s/AKfycbySgsOv083Th7Rg9ECTDEybsciew2uBBq7fvzJF6vlY_DNjxdcVcLJAcq3Ji-v8oJjk/exec";

let currentData = [];

// Build ticker
function renderTicker(data) {
  const html = data.map(t => {
    const dir = t.direction === "up" ? "▲" : "▼";
    return `<span class="symbol" id="${t.symbol}">
      ${t.symbol} ${dir} <span class="${t.direction} price">${t.price}</span>
      <span class="${t.direction} change">${t.change}</span></span>`;
  }).join('');
  ticker.innerHTML = html + html;
  ticker.classList.add('scrolling');
}

// Update data in place
async function loadTickers() {
  try {
    const res = await fetch(FEED_URL, { cache: "no-store" });
    if (!res.ok) throw new Error("Feed not reachable");
    const data = await res.json();
    if (!Array.isArray(data) || data.length === 0) return;

    if (currentData.length === 0) {
      currentData = data;
      renderTicker(data);
      return;
    }

    data.forEach(t => {
      const el = document.getElementById(t.symbol);
      if (el) {
        const priceEl = el.querySelector('.price');
        const changeEl = el.querySelector('.change');
        if (priceEl) priceEl.textContent = t.price;
        if (changeEl) changeEl.textContent = t.change;
        if (priceEl) priceEl.className = `${t.direction} price`;
        if (changeEl) changeEl.className = `${t.direction} change`;
      }
    });
    currentData = data;
  } catch (err) {
    console.error(err);
    ticker.innerHTML = "<span style='color:red;'>Error loading ticker feed.</span>";
  }
}

// Run and refresh
loadTickers();
setInterval(loadTickers, 30000);
</script>
</body>
</html>
